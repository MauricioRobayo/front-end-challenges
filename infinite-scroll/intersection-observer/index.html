<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Infinite Scroll</title>
    <style>
      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .container img {
        background-color: lightgrey;
        height: 320px;
        margin: 1rem 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container"></div>
    <div id="img-loader">Loading images...</div>
    <script>
      const container = document.querySelector(".container");
      const imgLoader = document.querySelector("#img-loader");
      const imgsPerBatch = 10
      const winHeight = window.innerHeight // viewport height
      const imgHeight = 320
      const neededImgs = Math.ceil(winHeight / imgHeight)
      const observer = new IntersectionObserver(loadImgs);

      function randomInt() {
        return Math.floor(Math.random() * 100000);
      }

      function generateImgs(totalImgs) {
        const imgs = [];
        for (let i = 0; i < totalImgs; i++) {
          const img = document.createElement("img");
          const imgName = randomInt()
          img.src = `http://api.adorable.io/avatars/${imgName}`;
          img.alt = imgName;
          imgs.push(img);
        }
        return imgs;
      }

      function appendImgs(container, totalImgs) {
        const imgs = generateImgs(totalImgs);
        container.append(...imgs);
      }

      function loadImgs(entries) {
        entries.forEach((entry) => {
          if (entry.target === imgLoader && entry.isIntersecting) {
            appendImgs(container, imgsPerBatch);
          }
        });
      }

      observer.observe(imgLoader);

      if (imgsPerBatch <= neededImgs) {
        appendImgs(container, neededImgs - imgsPerBatch)
      }
    </script>
  </body>
</html>
